_format_version: "3.0"

services:
  - name: arithmetic-service
    url: http://arithmetic-backend-cluster-ip-service:80
    routes:
    - name: arithmetic-route
      paths:
        - /api/arithmetic
      methods:
        - "GET"
        - "POST"
        - "PUT"
        - "DELETE"
      strip_path: true
      protocols:
        - "http"
        - "https"
    plugins:
      - name: rate-limiting
        config:
          minute: 10
          policy: local
          limit_by: ip
          hide_client_headers: true
          fault_tolerant: false

plugins:
  - name: correlation-id
    config:
      header_name: Request-ID
      generator: uuid
      echo_downstream: true

  - name: request-size-limiting
    config:
      allowed_payload_size: 5
      size_unit: "megabytes"

  - name: oidc
    config:
      client_id: "nuqu1jq1cqdfjr3no9ajhq0s9"
      client_secret: "not-necessary"
      discovery: "https://cognito-idp.sa-east-1.amazonaws.com/sa-east-1_wf8YNqFIo/.well-known/openid-configuration"
      unauth_action: "deny"
      bearer_jwt_auth_enable: "yes"
